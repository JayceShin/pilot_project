# ë§¤ì¶œ ì˜ˆì¸¡

    â­ ì½”ë¡œë‚˜ ë° ë‹¤ì–‘í•œ ì™¸ë¶€ ìš”ì¸ì„ ë°˜ì˜í•œ ì¼ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ë¥¼ ì‚°ì¶œí•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“– **ëª©ì°¨**

[1. í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)

[2. ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬](#2-ë°ì´í„°-ìˆ˜ì§‘-ë°-ì „ì²˜ë¦¬)

[3. ëª¨ë¸ë§](#3-ëª¨ë¸ë§)

[4. ìˆ˜í–‰ ê²°ê³¼](#4-ìˆ˜í–‰-ê²°ê³¼)
***
## 1 í”„ë¡œì íŠ¸ ê°œìš”

### ë°°ê²½

ê²½ì˜ìë“¤ì€ ì¼ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ì™€ í˜„ì¬ ë§¤ì¶œì•¡ì„ ë¹„êµí•˜ëŠ” í™”ë©´ì„ í†µí•´ ê²½ì˜ ë° í‰ê°€ ì§€í‘œë¡œ ì‚¼ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°°ê²½ì†ì— 20ë…„ 3ì›” ì½”ë¡œë‚˜ ì‚¬íƒœë•Œ ë°±í™”ì  ì‹í’ˆê´€ ë§¤ì¶œì´ ê°ì†Œí•˜ë©´ì„œ ì¼ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ì— í•œì°¸ ëª»ë¯¸ì¹˜ëŠ” ë‹¬ì„±ë¥ ì„ ë³´ì˜€ê³ , í•´ë‹¹ ë¶€ì„œì—ì„œ ì¼ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ì— ëŒ€í•œ ë¬¸ì˜ê°€ ë“¤ì–´ì˜¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë¡œì§ì„ í™•ì¸í•˜ì—¬ë³´ë‹ˆ ë‹¨ìˆœíˆ 3ê°œë…„ ë§¤ì¶œì˜ í‰ê· ì„ ì‚°ì¶œí•˜ê³  ìˆì—ˆê³ , ì´ëŠ” í˜„ìƒí™©ì„ ë°˜ì˜í•˜ì§€ ëª»í•œë‹¤ê³  íŒë‹¨í•˜ì—¬ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œí•œ ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ë¥¼ ìƒˆë¡œ ì‚°ì¶œí•˜ê³ ì í•˜ì˜€ìŠµë‹ˆë‹¤.    
ex) 2021ë…„ 9ì›” 26ì¼ì˜ ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ = (2018ë…„ 9ì›” 26ì¼ ë§¤ì¶œì•¡ + 2019ë…„ 9ì›” 26ì¼ ë§¤ì¶œì•¡ + 2020ë…„  9ì›” 26ì¼ ë§¤ì¶œì•¡)/3

![ë§¤ì¶œ_ë¹„êµ](https://user-images.githubusercontent.com/31294995/134776808-85fce0b9-b3c0-4a6b-a93e-c5abeb81c0d0.jpg)

### ëª©í‘œ

    ë§¤ì¶œ ì˜ˆì¸¡ì¹˜ê°€ ìµœê·¼ ê²½í–¥ì„ ë°˜ì˜í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ê·¼ê±°ìˆëŠ” ë§¤ì¶œ ëª©í‘œì¹˜ë¥¼ ì‚°ì¶œí•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.

***
## 2 ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬

### ë°ì´í„° ìˆ˜ì§‘

    DBì—ì„œ í¬ìŠ¤ì—ì„œ ë°œìƒí•œ ìµœê·¼ 3ë…„ì˜ ë§¤ì¶œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì˜€ìŠµë‹ˆë‹¤.
    ì´ì™¸ë¡œ ë°±í™”ì  íœ´ì ì¼, ë°±í™”ì  í–‰ì‚¬ ê·¸ë¦¬ê³  ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ë°ì´í„° ë¶„ì„ì— ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

### ì „ì²˜ë¦¬

1. ì´ ë§¤ì¶œì•¡   
í¬ìŠ¤ ë§¤ì¶œ ë°ì´í„°ì—ì„œ ì‹í’ˆê´€ì— í•´ë‹¹í•˜ëŠ” í’ˆëª©ë“¤ë¡œ êµ¬ì„±í•˜ì—¬ ì¼ë§¤ì¶œ í•©ê³„ë¥¼ ì‚°ì¶œí•˜ì˜€ìŠµë‹ˆë‹¤.

2. í–‰ì‚¬   
ì§€ì ì—ì„œ ë°œìƒí•œ í–‰ì‚¬ë“¤ ì¤‘ ì¼ë°˜ ê³ ê°ì—ê²Œ í•´ë‹¹í•˜ëŠ” í–‰ì‚¬ë§Œì„ ì¶”ì¶œí•˜ì˜€ê³ , boundaryë¥¼ í†µí•´ í–‰ì‚¬ ê¸°ê°„ ì „ë°˜ì— ì˜í–¥ì„ ì£¼ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

***
## 3 ëª¨ë¸ë§

    ì‹œê³„ì—´ ë°ì´í„°ì˜ ì˜ˆì¸¡ë¬¸ì œì´ê¸° ë•Œë¬¸ì— í†µê³„ì  ë°©ë²•ê³¼ ê¸°ê³„í•™ìŠµ ë°©ë²• ë‘ ê°€ì§€ë¡œ ì ‘ê·¼í•˜ì˜€ìŠµë‹ˆë‹¤.

### Statistics Modeling

    ê¸ˆì•¡ ì˜ˆì¸¡ì´ë¯€ë¡œ í‰ê°€ì§€í‘œëŠ” R2ë¡œ ì„ ì •í•˜ì˜€ê³ , 3ì›” ì‹¤ì œ ì¼ë§¤ì¶œê³¼ ì˜ˆì¸¡ ë§¤ì¶œë¡œ ë¹„êµí•˜ì˜€ìŠµë‹ˆë‹¤.

1. Simple Moving Average
ë‹¨ìˆœì´ë™í‰ê· ì€ íŠ¹ì • ê¸°ê°„ ë™ì•ˆì˜ dataë¥¼ ë‹¨ìˆœ í‰ê· í•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê·¸ ê¸°ê°„ ë™ì•ˆì˜ dataë¥¼ ëŒ€í‘œí•˜ëŠ” ê°’ì´ ì´ë™í‰ê·  ì•ˆì—ëŠ” ê·¸ ë™ì•ˆì˜ data ì›€ì§ì„ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë™í‰ê· ì˜ íŠ¹ì§•ì¸ ì§€ì—°(lag)ì´ ë°œìƒí•˜ë©° ìˆ˜í•™ì ìœ¼ë¡œ n/2 ì‹œê°„ ë§Œí¼ì˜ ì§€ì—°ì´ ë°œìƒí•©ë‹ˆë‹¤. ë‹¨ìˆœì´ë™í‰ê· ì€ ëª¨ë“  ë°ì´í„°ì˜ ì¤‘ìš”ë„ë¥¼ ë™ì¼í•˜ë‹¤ê³  ê°„ì£¼í•©ë‹ˆë‹¤.

```python
def make_sma_arr(dataframe, col, start, window):
    result = pd.DataFrame(columns = ['index','r2'])
    result2 = dataframe.copy()

    for i in range(start,window+1):
        pred = pd.DataFrame()
        sma_month = pd.DataFrame()

        sma_month['MA'] = pd.Series.rolling(dataframe[col],window=i, center=False).mean()
        pred['pred'] = sma_month['MA'].shift(1)
        st = pred.apply(pd.Series.first_valid_index)
        y = dataframe[col][st[0]:]
        y_pred = sma_month['MA'][st[0]:]
        #rmse = mean_squared_error(y, y_pred)**0.5
        r2 = r2_score(y,y_pred)
        result = result.append({'index': "{0:.0f}".format(i),'r2':"{0:.03f}".format(r2)}, ignore_index=True)
        result2.insert(i, str(i)+"ma",sma_month['MA'])
    
    return result, result2
    
# ì´ë™í‰ê·  window size 2, 3, 4
result, result2 = make_sma_arr(df_date_sum, 'SALE_AMT',2,4)    
```

2. Exponential Moving Average
ì§€ìˆ˜ì´ë™í‰ê· ì€ ê°€ì¤‘ì´ë™í‰ê·  ì¤‘ì˜ í•˜ë‚˜ë¡œ ë‹¨ìˆœì´ë™í‰ê· ë³´ë‹¤ ìµœê·¼ì˜ ë°ì´í„°ì— ë†’ì€ ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

```python
def make_emw_arr(dataframe, col, start, window):
    result = pd.DataFrame(columns = ['index','r2'])
    result2 = dataframe.copy()

    for i in range(start,window+1):
        pred = pd.DataFrame()
        sma_month = pd.DataFrame()

        sma_month['MA'] = dataframe[col].ewm(span=i).mean().values
        pred['pred'] = sma_month['MA'].shift(1)
        st = pred.apply(pd.Series.first_valid_index)
        y = dataframe[col][st[0]:]
        y_pred = sma_month['MA'][st[0]:]
        #rmse = mean_squared_error(y, y_pred)**0.5
        r2 = r2_score(y,y_pred)
        result = result.append({'index': "{0:.0f}".format(i),'r2':"{0:.03f}".format(r2)}, ignore_index=True)
        result2.insert(i, str(i)+"ew",sma_month['MA'])
    
    return result, result2
    
# ë‹¨ìˆœì§€ìˆ˜í‰í™œë¡œ ì˜ˆì¸¡í•œ ê²°ê³¼ì™€ ì‹¤ì œ ê²°ê³¼ ë¹„êµ
plot_model_graph(result2.tail(10), 'SALE_YMD', ['SALE_AMT','2ew','3ew','4ew'])
```

3. Simple Exponential Smoothing
trendë‚˜ seasonality ë°˜ì˜ì„ í•˜ì§€ ëª»í•˜ë©° level ì •ë„ë§Œ ìˆ˜í‰ì„ ìœ¼ë¡œ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.

```python
ssm1=SimpleExpSmoothing(df_date_sum.SALE_AMT).fit(smoothing_level=0.05,optimized=False)
ssm2=SimpleExpSmoothing(df_date_sum.SALE_AMT).fit(smoothing_level=0.3,optimized=False)
ssm0=SimpleExpSmoothing(df_date_sum.SALE_AMT).fit()
y_pred0 = ssm0.fittedvalues
y_pred1 = ssm1.fittedvalues
y_pred2 = ssm2.fittedvalues
```

4. Holt-Winter's Exponential Smoothing
trendë¡œ ë°ì´í„°ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ Simple Exponential Smoothingì—ì„œ í™•ì¥í•œ ê²ƒì…ë‹ˆë‹¤. ì˜ˆì¸¡ì„ ìœ„í•œ ì‹ ì™¸ì— level smoothingì„ ìœ„í•œ ì‹ê³¼ trend smoothingì„ ìœ„í•œ ì‹ì´ í¬í•¨ë©ë‹ˆë‹¤. ìƒì„±ëœ ì˜ˆì¸¡ì€ ì„ í˜•ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ê¸° ë•Œë¬¸ì— ì˜ˆì¸¡ ë²”ìœ„ê°€ ë©€ì–´ì§ˆ ìˆ˜ë¡ over-forecast ë˜ëŠ” ê²½í–¥ì´ ìˆë‹¤.

```python
holt_fit0=Holt(df_date_sum.SALE_AMT).fit(smoothing_level=0.8,smoothing_slope=0.3) #holt additive model
holt_fit1=Holt(df_date_sum.SALE_AMT,exponential=True).fit(smoothing_level=0.8,smoothing_slope=0.3) #holt exponential model
holt_fit2=Holt(df_date_sum.SALE_AMT,damped=True).fit(smoothing_level=0.8,smoothing_slope=0.3) #holt damped trend
y = result2.SALE_AMT
y_pred0 = holt_fit0.fittedvalues
y_pred1 = holt_fit1.fittedvalues
y_pred2 = holt_fit2.fittedvalues
```

### Machin Learning Modeling




***
